# CBS1 Offer Importer

A Python script that batch-parses Colorado CBS1 real estate contracts (PDF) and writes each offer as a new column in an Excel multi-offer comparison spreadsheet.

Built for myself to use as a real estate agent. On several occasions, I was manually entering data from 10–25 competing offers into a spreadsheet on offer review day — a process that took hours and was error-prone. This script does it in minutes.

---

## The Problem

Colorado residential real estate contracts (CBS1 form) are generated by CTM eContracts as PDFs. Each offer contains ~50 fields of interest: purchase price, earnest money, loan type, closing cost allocations, dates, deadlines, and additional provisions.

When reviewing multiple competing offers, agents and investors need all of this in a side-by-side comparison spreadsheet. Doing it by hand from 13 PDFs takes 2–3 hours and introduces transcription errors.

---

## Why This Was Hard

The first attempt was in VBA, using `pdftotext.exe` to extract text. That approach hit a hard ceiling for two reasons:

**1. pdftotext discards spatial information.** It dumps the PDF character stream in storage order, not visual order. Tables get scrambled, multi-line fields run together, and there's no way to know where on the page any piece of text actually appeared.

**2. Checkboxes are invisible to text extraction.** CTM eContracts PDFs use bitmapped checkbox images — not PDF form fields — to indicate selections like who pays closing costs, title insurance, transfer taxes, etc. Any tool that only reads the text stream sees all the options listed (e.g. *"Buyer / Seller / One-Half / N/A"*) but has no way to know which one is checked.

Switching to Python with `pdfplumber` solved both problems.

---

## How It Works

### Text fields
`pdfplumber` extracts every character with its exact x/y coordinates on the page. This makes it straightforward to locate fields by section number, parse the deadline table by spatial position, and handle multi-line fields correctly.

### Checkbox detection (the interesting part)
For fee allocation sections (§8.1, §15.2–15.8, §16.2), the script:

1. Locates the section header in the character stream, filtering out cross-references (e.g. skipping *"§ 16.2"* mentioned in other sections and finding the actual *"16.2. Association Assessments"* header)
2. Scans downward to find the options line — the line that contains both *"Buyer"* and *"Seller"* text with checkbox images at the same y-coordinate
3. Renders the page as a raster image at 150 DPI
4. Crops each 10.5×10.5pt checkbox region and measures average pixel brightness
5. The darkest checkbox (brightness < 150/255) is the checked one
6. Maps the label to the right of that checkbox to the spreadsheet dropdown value

This approach works because checked boxes render as dark filled squares and unchecked boxes render as light empty squares — a consistent, reliable signal across all CTM eContracts PDFs.

### Excel output
Uses `openpyxl` to write values into a structured comparison template, copying formatting, formulas, column widths, and dropdown validations from the template's reference column into each new offer column.

---

## What It Parses

| Category | Fields |
|---|---|
| Parties | Buyer name, listing agent |
| Price | Purchase price, earnest money, seller concession, commission % |
| Financing | Loan amount, loan type (Cash / Conventional / FHA / VA), lender |
| Fee allocations | §8.1 Title insurance, §8.1.3 OEC, §15.2–15.8 closing/transfer fees, §16.2 association assessments |
| Deadlines | All 35 items from the §3.1 dates and deadlines table |
| Terms | Inclusions, exclusions, additional provisions |

---

## Requirements

```
pip install pdfplumber openpyxl Pillow
```

Python 3.8+. No other dependencies. Tested on CTM eContracts CBS1 v4.0 PDFs.

---

## Usage

```
python import_offers.py
```

The script prompts for:
1. The folder containing your offer PDFs
2. Your Excel comparison template

It processes all PDFs in the folder and saves a new file (`template_filled.xlsx`) without modifying your original template.

**Output during run:**
```
[1/13] A_and_Z_TLC_CONTRACT.pdf ... OK  —  A & Z TLC LLC  /  $285,000
[2/13] Black_Diamond_CONTRACT.pdf ... OK  —  Black Diamond 2560 Residential Trust  /  $295,000
...
Saved → Multi-Offer_Comparison_filled.xlsx
```

---

## Notes

- **OEC (§8.1.3):** The CBS1 form only has a Will / Will Not checkbox for OEC — there is no Buyer/Seller dropdown. The script outputs *"Buyer Pays"* when OEC is checked (standard convention) and *"n/a"* when unchecked. If a seller is covering OEC costs that should be noted manually.
- **Escalation clauses, appraisal gap, lender letter:** These are manually-entered fields and are intentionally left blank for the reviewer to fill in.
- **PDF template not included:** The Excel comparison template is not part of this repository.

---

## Background

I built this while working in real estate investment. On competitive offer review days, the ability to get all offers into a comparison grid quickly — and accurately — has real dollar value. The checkbox detection problem in particular was an interesting constraint: the solution exists entirely below the level of text and required dropping down to pixel analysis to solve it.
